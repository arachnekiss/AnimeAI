// API í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸
// ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ì—ì„œ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸

console.log('ğŸš€ Starting AI Engine API Tests...');

// í…ŒìŠ¤íŠ¸ 1: API ì—°ê²° ê¸°ë³¸ í™•ì¸
async function testBasicConnection() {
  console.log('ğŸ“¡ Testing basic connection...');
  
  try {
    // ê¸°ë³¸ fetch í…ŒìŠ¤íŠ¸
    const response = await fetch('https://api.openai.com/v1/models', {
      method: 'HEAD', // OPTIONS ëŒ€ì‹  HEAD ì‚¬ìš©
    });
    
    console.log('âœ… OpenAI API endpoint is accessible');
    return true;
  } catch (error) {
    console.log('âŒ OpenAI API endpoint not accessible:', error.message);
    return false;
  }
}

// í…ŒìŠ¤íŠ¸ 2: ìºë¦­í„° ìƒì„± fallback í…ŒìŠ¤íŠ¸
async function testCharacterGenerationFallback() {
  console.log('ğŸ­ Testing character generation fallback...');
  
  try {
    // ì‹œë®¬ë ˆì´ì…˜ëœ ì§€ì—°ì‹œê°„
    await new Promise(resolve => setTimeout(resolve, 1000));
    
    const character = {
      id: 'test-' + Date.now(),
      name: 'Test Character',
      style: 'anime',
      hairColor: 'blue',
      eyeColor: 'green',
      personality: ['friendly', 'energetic'],
      backstory: 'A test character generated by fallback method'
    };
    
    console.log('âœ… Character generation fallback working:', character);
    return true;
  } catch (error) {
    console.log('âŒ Character generation fallback failed:', error.message);
    return false;
  }
}

// í…ŒìŠ¤íŠ¸ 3: ì• ë‹ˆë©”ì´ì…˜ ì—”ì§„ ì—°ê²° í™•ì¸
async function testAnimationEngine() {
  console.log('ğŸ¬ Testing animation engine connection...');
  
  try {
    // Canvas ìš”ì†Œ í™•ì¸
    const canvas = document.querySelector('canvas');
    if (!canvas) {
      throw new Error('Canvas element not found');
    }
    
    // ê¸°ë³¸ ë Œë”ë§ í…ŒìŠ¤íŠ¸
    const ctx = canvas.getContext('2d');
    if (!ctx) {
      throw new Error('Canvas context not available');
    }
    
    // í…ŒìŠ¤íŠ¸ ê·¸ë˜í”½ ê·¸ë¦¬ê¸°
    ctx.fillStyle = '#4CAF50';
    ctx.fillRect(10, 10, 50, 30);
    ctx.fillStyle = '#fff';
    ctx.font = '12px Arial';
    ctx.fillText('TEST', 15, 30);
    
    console.log('âœ… Animation engine basic rendering working');
    return true;
  } catch (error) {
    console.log('âŒ Animation engine test failed:', error.message);
    return false;
  }
}

// í…ŒìŠ¤íŠ¸ 4: UI ì¸í„°ë™ì…˜ í™•ì¸
async function testUIInteractions() {
  console.log('ğŸ–±ï¸ Testing UI interactions...');
  
  try {
    // ì£¼ìš” ë²„íŠ¼ ìš”ì†Œë“¤ í™•ì¸
    const buttons = document.querySelectorAll('button');
    if (buttons.length === 0) {
      throw new Error('No interactive buttons found');
    }
    
    // API í…ŒìŠ¤íŠ¸ ë²„íŠ¼ ì°¾ê¸°
    const apiTestButton = Array.from(buttons).find(btn => 
      btn.textContent.includes('Test AI Engine')
    );
    
    if (apiTestButton) {
      console.log('âœ… API Test button found and accessible');
    } else {
      console.log('âš ï¸ API Test button not found');
    }
    
    // ìºë¦­í„° ìƒì„± ë²„íŠ¼ ì°¾ê¸°
    const characterGenButton = Array.from(buttons).find(btn => 
      btn.textContent.includes('Generate New Character')
    );
    
    if (characterGenButton) {
      console.log('âœ… Character generation button found');
    } else {
      console.log('âš ï¸ Character generation button not found');
    }
    
    console.log(`âœ… Found ${buttons.length} interactive elements`);
    return true;
  } catch (error) {
    console.log('âŒ UI interaction test failed:', error.message);
    return false;
  }
}

// í…ŒìŠ¤íŠ¸ 5: ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì„¤ì • í™•ì¸
async function testLocalStorage() {
  console.log('ğŸ’¾ Testing local storage functionality...');
  
  try {
    // í…ŒìŠ¤íŠ¸ ë°ì´í„° ì €ì¥/ì½ê¸°
    const testKey = 'ai-engine-test';
    const testValue = JSON.stringify({
      timestamp: Date.now(),
      test: 'success'
    });
    
    localStorage.setItem(testKey, testValue);
    const retrieved = localStorage.getItem(testKey);
    
    if (retrieved === testValue) {
      console.log('âœ… Local storage working properly');
      localStorage.removeItem(testKey); // ì •ë¦¬
      return true;
    } else {
      throw new Error('Local storage data mismatch');
    }
  } catch (error) {
    console.log('âŒ Local storage test failed:', error.message);
    return false;
  }
}

// ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
async function runAllTests() {
  console.log('ğŸ”¬ Running comprehensive AI Engine tests...');
  console.log('================================================');
  
  const results = {};
  
  results.basicConnection = await testBasicConnection();
  results.characterGeneration = await testCharacterGenerationFallback();
  results.animationEngine = await testAnimationEngine();
  results.uiInteractions = await testUIInteractions();
  results.localStorage = await testLocalStorage();
  
  console.log('================================================');
  console.log('ğŸ“Š Test Results Summary:');
  
  const total = Object.keys(results).length;
  const passed = Object.values(results).filter(Boolean).length;
  const failed = total - passed;
  
  console.log(`Total Tests: ${total}`);
  console.log(`Passed: ${passed} âœ…`);
  console.log(`Failed: ${failed} âŒ`);
  console.log(`Success Rate: ${((passed / total) * 100).toFixed(1)}%`);
  
  Object.entries(results).forEach(([test, result]) => {
    const status = result ? 'âœ…' : 'âŒ';
    console.log(`${status} ${test}`);
  });
  
  if (passed === total) {
    console.log('ğŸ‰ All tests passed! AI Engine is ready for real API testing.');
  } else if (passed >= total * 0.8) {
    console.log('âš ï¸ Most tests passed. Some features may need attention.');
  } else {
    console.log('ğŸš¨ Multiple test failures. Please check the setup.');
  }
  
  return results;
}

// ì‹¤ì œ API í‚¤ í…ŒìŠ¤íŠ¸ (ì„ íƒì‚¬í•­)
async function testWithRealAPI(apiKey) {
  if (!apiKey) {
    console.log('ğŸ”‘ No API key provided. Skipping real API tests.');
    return false;
  }
  
  console.log('ğŸ” Testing with real OpenAI API...');
  
  try {
    const response = await fetch('https://api.openai.com/v1/models', {
      headers: {
        'Authorization': `Bearer ${apiKey}`,
      }
    });
    
    if (response.ok) {
      const data = await response.json();
      console.log(`âœ… Real API test successful. ${data.data.length} models available.`);
      return true;
    } else {
      console.log(`âŒ Real API test failed: ${response.status} ${response.statusText}`);
      return false;
    }
  } catch (error) {
    console.log('âŒ Real API test error:', error.message);
    return false;
  }
}

// ì‚¬ìš© ë°©ë²• ì•ˆë‚´
console.log(`
ğŸ”¬ AI Engine API Test Console
=============================

ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ì‹¤í–‰:
> runAllTests()

ì‹¤ì œ API í‚¤ë¡œ í…ŒìŠ¤íŠ¸:
> testWithRealAPI('your-api-key-here')

ê°œë³„ í…ŒìŠ¤íŠ¸ ì‹¤í–‰:
> testBasicConnection()
> testCharacterGenerationFallback()
> testAnimationEngine()
> testUIInteractions()
> testLocalStorage()

---
ì‹œì‘í•˜ë ¤ë©´ runAllTests()ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”.
`);

// ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡
window.runAllTests = runAllTests;
window.testWithRealAPI = testWithRealAPI;
window.testBasicConnection = testBasicConnection;
window.testCharacterGenerationFallback = testCharacterGenerationFallback;
window.testAnimationEngine = testAnimationEngine;
window.testUIInteractions = testUIInteractions;
window.testLocalStorage = testLocalStorage;
